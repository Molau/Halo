<!DOCTYPE html>
<html lang="{{ lang() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ g.i18n.get('menu_titles.analysis') }} - HALO</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='fonts/bootstrap-icons/bootstrap-icons.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/github-markdown.min.css') }}">
    <style>
        /* Keep filter2 select background white when disabled, only grey out text */
        #filter2-select:disabled {
            background-color: #ffffff;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        /* Print styles for analysis results */
        @media print {
            /* Set page margins */
            @page {
                margin: 0cm;
            }
            
            /* Remove top margin from body */
            body {
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Hide main page content */
            .container-fluid, #results-area, #param-dialog {
                display: none !important;
            }
            
            /* Hide header, footer, modal chrome, and backdrop */
            header, footer, .modal-header, .modal-footer, .btn-close,
            nav, .navbar, .modal-backdrop {
                display: none !important;
            }
            
            /* Hide chart modals by default */
            #chartModal, #chart3DModal {
                display: none !important;
            }
            
            /* Show results modal by default */
            #resultModal {
                position: static !important;
                display: block !important;
            }
            
            /* When chart modal has 'show' class, display it and hide results */
            #chartModal.show {
                position: static !important;
                display: block !important;
            }
            
            #chart3DModal.show {
                position: static !important;
                display: block !important;
            }
            
            #chartModal.show ~ #resultModal,
            #chart3DModal.show ~ #resultModal,
            body:has(#chartModal.show) #resultModal,
            body:has(#chart3DModal.show) #resultModal {
                display: none !important;
            }
            
            .modal {
                position: static !important;
                display: block !important;
            }
            
            .modal-dialog {
                max-width: 100% !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                max-height: none !important;
                height: auto !important;
            }
            
            .modal-content {
                border: none !important;
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .modal-body {
                overflow: visible !important;
                max-height: none !important;
                padding: 0 !important;
                margin: 0 !important;
                background-color: white !important;
            }
            
            /* Override scrollable */
            .modal-dialog-scrollable .modal-body {
                max-height: none !important;
                overflow-y: visible !important;
            }
        }
    </style>
</head>
<body>
    {% include 'header.html' %}

    <!-- Main Content Area -->
    <div class="container-fluid mt-3">
        <div class="row">
            <div class="col">
                <div id="results-area">
                    <!-- Results will be displayed here after parameter selection -->
                </div>
            </div>
        </div>
    </div>

    <!-- Parameter Selection Dialog (shown on page load) -->
    <div class="modal fade" id="param-dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ g.i18n.get('analysis_dialog.title') }}</h5>
                </div>
                <div class="modal-body">
                    <!-- First Parameter (mandatory) -->
                    <div class="mb-3">
                        <label for="param1-select" class="form-label">
                            {{ g.i18n.get('analysis_dialog.first_param') }} <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="param1-select" required autofocus>
                            <option value="">{{ g.i18n.get('common.please_select') }}</option>
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Range Selection for First Parameter (shown after selection) -->
                    <div id="param1-range" style="display: none;">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param1-from" class="form-label">{{ g.i18n.get('common.from') }}</label>
                                <select class="form-select" id="param1-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param1-to" class="form-label">{{ g.i18n.get('common.to') }}</label>
                                <select class="form-select" id="param1-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for day parameter (TT) -->
                    <div id="param1-day-fields" style="display: none;">
                        <!-- Day range restrictions (first and last day) on top -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param1-day-from" class="form-label">{{ g.i18n.get('analysis_dialog.from_day') }}</label>
                                <select class="form-select" id="param1-day-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param1-day-to" class="form-label">{{ g.i18n.get('analysis_dialog.to_day') }}</label>
                                <select class="form-select" id="param1-day-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>

                        <!-- Month and Year as extra input below -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param1-month" class="form-label">{{ g.i18n.get('common.month') }}:</label>
                                <select class="form-select" id="param1-month">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param1-year" class="form-label">{{ g.i18n.get('common.year') }}:</label>
                                <select class="form-select" id="param1-year">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for time parameter (ZZ) -->
                    <div id="param1-time-fields" style="display: none;">
                        <label class="form-label">
                            {{ g.i18n.get('analysis_dialog.timezone') }}
                        </label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="param1-timezone" id="param1-tz-cet" value="cet" checked>
                            <label class="form-check-label" for="param1-tz-cet">
                                {{ g.i18n.get('analysis_dialog.cet') }}
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="param1-timezone" id="param1-tz-local" value="local">
                            <label class="form-check-label" for="param1-tz-local">
                                {{ g.i18n.get('analysis_dialog.local_time') }}
                            </label>
                        </div>
                    </div>

                    <!-- Special fields for solar altitude parameter (SH) -->
                    <div id="param1-sh-fields" style="display: none;">
                        <!-- Range selection for SH parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param1-sh-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param1-sh-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param1-sh-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param1-sh-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.sh_interval_question') }}
                            </label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-sh-time" id="param1-sh-min" value="min">
                                <label class="form-check-label" for="param1-sh-min">
                                    {{ g.i18n.get('common.minimum') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-sh-time" id="param1-sh-mean" value="mean" checked>
                                <label class="form-check-label" for="param1-sh-mean">
                                    {{ g.i18n.get('common.mean') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-sh-time" id="param1-sh-max" value="max">
                                <label class="form-check-label" for="param1-sh-max">
                                    {{ g.i18n.get('common.maximum') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for halo type parameter (EE) -->
                    <div id="param1-ee-fields" style="display: none;">
                        <!-- Range selection for EE parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param1-ee-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param1-ee-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param1-ee-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param1-ee-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.composite_halo_types') }}
                            </label>
                            <br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-ee-split" id="param1-ee-split" value="split" checked>
                                <label class="form-check-label" for="param1-ee-split">
                                    {{ g.i18n.get('common.split') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-ee-split" id="param1-ee-nosplit" value="nosplit">
                                <label class="form-check-label" for="param1-ee-nosplit">
                                    {{ g.i18n.get('common.dont_split') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for cirrus type parameter (C) -->
                    <div id="param1-c-fields" style="display: none;">
                        <!-- Range selection for C parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param1-c-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param1-c-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param1-c-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param1-c-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.composite_cirrus_types') }}
                            </label>
                            <br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-c-split" id="param1-c-split" value="split" checked>
                                <label class="form-check-label" for="param1-c-split">
                                    {{ g.i18n.get('common.split') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-c-split" id="param1-c-nosplit" value="nosplit">
                                <label class="form-check-label" for="param1-c-nosplit">
                                    {{ g.i18n.get('common.dont_split') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for duration parameter (DD) -->
                    <div id="param1-dd-fields" style="display: none;">
                        <!-- Range selection for DD parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param1-dd-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param1-dd-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param1-dd-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param1-dd-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.incomplete_observations') }}
                            </label><br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-dd-incomplete" id="param1-dd-incomplete" value="include" checked>
                                <label class="form-check-label" for="param1-dd-incomplete">
                                    {{ g.i18n.get('common.use') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param1-dd-incomplete" id="param1-dd-complete" value="exclude">
                                <label class="form-check-label" for="param1-dd-complete">
                                    {{ g.i18n.get('common.dont_use') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Second Parameter (optional) -->
                    <div class="mb-3">
                        <label for="param2-select" class="form-label">
                            {{ g.i18n.get('analysis_dialog.second_param') }}
                        </label>
                        <select class="form-select" id="param2-select">
                            <option value="">
                                {{ g.i18n.get('analysis_dialog.no_second_param') }}
                            </option>
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Range Selection for Second Parameter (shown after selection) -->
                    <div id="param2-range" style="display: none;">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param2-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param2-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param2-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param2-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for day parameter (TT) in param2 -->
                    <div id="param2-day-fields" style="display: none;">
                        <!-- Day range restrictions (first and last day) on top -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param2-day-from" class="form-label">{{ g.i18n.get('analysis_dialog.from_day') }}</label>
                                <select class="form-select" id="param2-day-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param2-day-to" class="form-label">{{ g.i18n.get('analysis_dialog.to_day') }}</label>
                                <select class="form-select" id="param2-day-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>

                        <!-- Month and Year as extra input below -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param2-month" class="form-label">{{ g.i18n.get('common.month') }}:</label>
                                <select class="form-select" id="param2-month">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param2-year" class="form-label">{{ g.i18n.get('common.year') }}:</label>
                                <select class="form-select" id="param2-year">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for time parameter (ZZ) in param2 -->
                    <div id="param2-time-fields" style="display: none;">
                        <label class="form-label">
                            {{ g.i18n.get('analysis_dialog.timezone') }}
                        </label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="param2-timezone" id="param2-tz-cet" value="cet" checked>
                            <label class="form-check-label" for="param2-tz-cet">
                                {{ g.i18n.get('analysis_dialog.cet') }}
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="param2-timezone" id="param2-tz-local" value="local">
                            <label class="form-check-label" for="param2-tz-local">
                                {{ g.i18n.get('analysis_dialog.local_time') }}
                            </label>
                        </div>
                    </div>

                    <!-- Special fields for solar altitude parameter (SH) in param2 -->
                    <div id="param2-sh-fields" style="display: none;">
                        <!-- Range selection for SH parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param2-sh-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param2-sh-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param2-sh-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param2-sh-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.sh_interval_question') }}
                            </label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-sh-time" id="param2-sh-min" value="min">
                                <label class="form-check-label" for="param2-sh-min">
                                    {{ g.i18n.get('common.minimum') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-sh-time" id="param2-sh-mean" value="mean" checked>
                                <label class="form-check-label" for="param2-sh-mean">
                                    {{ g.i18n.get('common.mean') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-sh-time" id="param2-sh-max" value="max">
                                <label class="form-check-label" for="param2-sh-max">
                                    {{ g.i18n.get('common.maximum') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for halo type parameter (EE) in param2 -->
                    <div id="param2-ee-fields" style="display: none;">
                        <!-- Range selection for EE parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param2-ee-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param2-ee-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param2-ee-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param2-ee-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.composite_halo_types') }}
                            </label>
                            <br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-ee-split" id="param2-ee-split" value="split" checked>
                                <label class="form-check-label" for="param2-ee-split">
                                    {{ g.i18n.get('common.split') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-ee-split" id="param2-ee-nosplit" value="nosplit">
                                <label class="form-check-label" for="param2-ee-nosplit">
                                    {{ g.i18n.get('common.dont_split') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for cirrus type parameter (C) in param2 -->
                    <div id="param2-c-fields" style="display: none;">
                        <!-- Range selection for C parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param2-c-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param2-c-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param2-c-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param2-c-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.composite_cirrus_types') }}
                            </label>
                            <br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-c-split" id="param2-c-split" value="split" checked>
                                <label class="form-check-label" for="param2-c-split">
                                    {{ g.i18n.get('common.split') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-c-split" id="param2-c-nosplit" value="nosplit">
                                <label class="form-check-label" for="param2-c-nosplit">
                                    {{ g.i18n.get('common.dont_split') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Special fields for duration parameter (DD) in param2 -->
                    <div id="param2-dd-fields" style="display: none;">
                        <!-- Range selection for DD parameter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="param2-dd-from" class="form-label">
                                    {{ g.i18n.get('common.from') }}:
                                </label>
                                <select class="form-select" id="param2-dd-from">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="param2-dd-to" class="form-label">
                                    {{ g.i18n.get('common.to') }}:
                                </label>
                                <select class="form-select" id="param2-dd-to">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.incomplete_observations') }}
                            </label><br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-dd-incomplete" id="param2-dd-incomplete" value="include" checked>
                                <label class="form-check-label" for="param2-dd-incomplete">
                                    {{ g.i18n.get('common.use') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="param2-dd-incomplete" id="param2-dd-complete" value="exclude">
                                <label class="form-check-label" for="param2-dd-complete">
                                    {{ g.i18n.get('common.dont_use') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Percentage Mode (for two-parameter analysis) -->
                    <div id="percentage-mode-fields" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.percentage_mode_label') }}
                            </label><br>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="percentage-mode" id="percentage-global" value="global" checked>
                                <label class="form-check-label" for="percentage-global">
                                    {{ g.i18n.get('analysis_dialog.percentage_global') }}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="percentage-mode" id="percentage-param1" value="param1">
                                <label class="form-check-label" for="percentage-param1">
                                    {{ g.i18n.get('analysis_dialog.percentage_param1') }}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="percentage-mode" id="percentage-param2" value="param2">
                                <label class="form-check-label" for="percentage-param2">
                                    {{ g.i18n.get('analysis_dialog.percentage_param2') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- First Filter Parameter (optional) -->
                    <div class="mb-3">
                        <label for="filter1-select" class="form-label">
                            {{ g.i18n.get('analysis_dialog.first_filter_param') }}
                        </label>
                        <select class="form-select" id="filter1-select">
                            <option value="">
                                {{ g.i18n.get('analysis_dialog.no_filter') }}
                            </option>
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Filter1 Value (single selection, not range) -->
                    <div id="filter1-value" style="display: none;">
                        <div class="mb-3">
                            <label for="filter1-value-select" class="form-label">
                                {{ g.i18n.get('analysis_dialog.filter_value') }}
                            </label>
                            <select class="form-select" id="filter1-value-select">
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>

                    <!-- Filter1 Day Fields (for TT parameter) -->
                    <div id="filter1-day-fields" style="display: none;">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="filter1-month-select" class="form-label">
                                    {{ g.i18n.get('common.month') }}:
                                </label>
                                <select class="form-select" id="filter1-month-select">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="filter1-year-select" class="form-label">
                                    {{ g.i18n.get('common.year') }}:
                                </label>
                                <select class="form-select" id="filter1-year-select">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Filter1 Time Fields (for ZZ parameter) -->
                    <div id="filter1-time-fields" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.timezone') }}
                            </label><br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-timezone" id="filter1-tz-cet" value="CET" checked>
                                <label class="form-check-label" for="filter1-tz-cet">
                                    {{ g.i18n.get('analysis_dialog.cet') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-timezone" id="filter1-tz-local" value="local">
                                <label class="form-check-label" for="filter1-tz-local">
                                    {{ g.i18n.get('analysis_dialog.local_time') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Filter1 Solar Altitude Fields (for SH parameter) -->
                    <div id="filter1-sh-fields" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('common.solar_altitude') }}
                            </label><br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-sh-time" id="filter1-sh-min" value="min">
                                <label class="form-check-label" for="filter1-sh-min">
                                    {{ g.i18n.get('common.minimum') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-sh-time" id="filter1-sh-mean" value="mean" checked>
                                <label class="form-check-label" for="filter1-sh-mean">
                                    {{ g.i18n.get('common.mean') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-sh-time" id="filter1-sh-max" value="max">
                                <label class="form-check-label" for="filter1-sh-max">
                                    {{ g.i18n.get('common.maximum') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Filter1 Halo Type Split Fields (for EE parameter) -->
                    <div id="filter1-ee-fields" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.halo_types_label') }}
                            </label><br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-ee-split" id="filter1-ee-split-yes" value="split" checked>
                                <label class="form-check-label" for="filter1-ee-split-yes">
                                    {{ g.i18n.get('common.split') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-ee-split" id="filter1-ee-split-no" value="no-split">
                                <label class="form-check-label" for="filter1-ee-split-no">
                                    {{ g.i18n.get('common.dont_split') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Filter1 Cirrus Type Split Fields (for C parameter) -->
                    <div id="filter1-c-fields" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.cirrus_types_label') }}
                            </label><br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-c-split" id="filter1-c-split-yes" value="split" checked>
                                <label class="form-check-label" for="filter1-c-split-yes">
                                    {{ g.i18n.get('common.split') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-c-split" id="filter1-c-split-no" value="no-split">
                                <label class="form-check-label" for="filter1-c-split-no">
                                    {{ g.i18n.get('common.dont_split') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Filter1 Duration Incomplete Fields (for DD parameter) -->
                    <div id="filter1-dd-fields" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">
                                {{ g.i18n.get('analysis_dialog.incomplete_observations') }}
                            </label><br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-dd-incomplete" id="filter1-dd-include" value="include" checked>
                                <label class="form-check-label" for="filter1-dd-include">
                                    {{ g.i18n.get('common.use') }}
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="filter1-dd-incomplete" id="filter1-dd-exclude" value="exclude">
                                <label class="form-check-label" for="filter1-dd-exclude">
                                    {{ g.i18n.get('common.dont_use') }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Second Filter Parameter (optional) -->
                    <div class="mb-3">
                        <label for="filter2-select" class="form-label">
                            {{ g.i18n.get('analysis_dialog.second_filter_param') }}
                        </label>
                        <select class="form-select" id="filter2-select">
                            <option value="">
                                {{ g.i18n.get('analysis_dialog.no_filter') }}
                            </option>
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Filter2 Value (single selection, not range) -->
                    <div id="filter2-value" style="display: none;">
                    <div class="mb-3">
                        <label for="filter2-value-select" class="form-label">
                            {{ g.i18n.get('analysis_dialog.filter_value') }}
                        </label>
                        <select class="form-select" id="filter2-value-select">
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>
                </div>

                <!-- Filter2 Day Fields (for TT parameter) -->
                <div id="filter2-day-fields" style="display: none;">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="filter2-month-select" class="form-label">
                                {{ g.i18n.get('common.month') }}:
                            </label>
                            <select class="form-select" id="filter2-month-select">
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="filter2-year-select" class="form-label">
                                {{ g.i18n.get('common.year') }}:
                            </label>
                            <select class="form-select" id="filter2-year-select">
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Filter2 Time Fields (for ZZ parameter) -->
                <div id="filter2-time-fields" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">
                            {{ g.i18n.get('analysis_dialog.timezone') }}
                        </label><br>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-timezone" id="filter2-tz-cet" value="CET" checked>
                            <label class="form-check-label" for="filter2-tz-cet">{{ g.i18n.get('analysis_dialog.cet') }}</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-timezone" id="filter2-tz-local" value="local">
                            <label class="form-check-label" for="filter2-tz-local">
                                {{ g.i18n.get('analysis_dialog.local_time') }}
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Filter2 Solar Altitude Fields (for SH parameter) -->
                <div id="filter2-sh-fields" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">
                            {{ g.i18n.get('common.solar_altitude') }}
                        </label><br>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-sh-time" id="filter2-sh-min" value="min">
                            <label class="form-check-label" for="filter2-sh-min">
                                {{ g.i18n.get('common.minimum') }}
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-sh-time" id="filter2-sh-mean" value="mean" checked>
                            <label class="form-check-label" for="filter2-sh-mean">
                                {{ g.i18n.get('common.mean') }}
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-sh-time" id="filter2-sh-max" value="max">
                            <label class="form-check-label" for="filter2-sh-max">
                                {{ g.i18n.get('common.maximum') }}
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Filter2 Halo Type Split Fields (for EE parameter) -->
                <div id="filter2-ee-fields" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">
                            {{ g.i18n.get('analysis_dialog.halo_types_label') }}
                        </label><br>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-ee-split" id="filter2-ee-split-yes" value="split" checked>
                            <label class="form-check-label" for="filter2-ee-split-yes">
                                {{ g.i18n.get('common.split') }}
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-ee-split" id="filter2-ee-split-no" value="no-split">
                            <label class="form-check-label" for="filter2-ee-split-no">
                                {{ g.i18n.get('common.dont_split') }}
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Filter2 Cirrus Type Split Fields (for C parameter) -->
                <div id="filter2-c-fields" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">
                            {{ g.i18n.get('analysis_dialog.cirrus_types_label') }}
                        </label><br>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-c-split" id="filter2-c-split-yes" value="split" checked>
                            <label class="form-check-label" for="filter2-c-split-yes">
                                {{ g.i18n.get('common.split') }}
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-c-split" id="filter2-c-split-no" value="no-split">
                            <label class="form-check-label" for="filter2-c-split-no">
                                {{ g.i18n.get('common.dont_split') }}
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Filter2 Duration Incomplete Fields (for DD parameter) -->
                <div id="filter2-dd-fields" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">
                            {{ g.i18n.get('analysis_dialog.incomplete_observations') }}
                        </label><br>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-dd-incomplete" id="filter2-dd-include" value="include" checked>
                            <label class="form-check-label" for="filter2-dd-include">
                                {{ g.i18n.get('common.use') }}
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="filter2-dd-incomplete" id="filter2-dd-exclude" value="exclude">
                            <label class="form-check-label" for="filter2-dd-exclude">
                                {{ g.i18n.get('common.dont_use') }}
                            </label>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm px-3" id="btn-cancel-param">
                        {{ g.i18n.get('common.cancel') }}
                    </button>
                    <button type="button" class="btn btn-primary btn-sm px-3" id="btn-apply-param">
                        {{ g.i18n.get('common.ok') }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% include 'footer.html' %}

    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart.umd.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plotly.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/marked.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analysis.js') }}"></script>
</body>
</html>
