<!DOCTYPE html>
<html lang="{{ lang() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HALO - {{ g.i18n.get('output.monthly_report') }}</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="d-flex flex-column min-vh-100">
    {% include 'header.html' %}

    <script>
        // Mark output menu as active
        document.addEventListener('DOMContentLoaded', () => {
            const menus = document.querySelectorAll('.menu-title');
            // Find Ausgabe/Output menu (6th menu item, index 5)
            if (menus[5]) menus[5].classList.add('active');
        });
    </script>

    <main class="container mt-4">
        <!-- Filter Selection Dialog Modal -->
        <div class="modal fade" id="filter-dialog" tabindex="-1" aria-labelledby="filterDialogLabel" aria-hidden="true" data-bs-backdrop="true" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="filterDialogLabel">
                            {{ g.i18n.get('output.monthly_report') }}
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="filter-form">
                            <!-- Combined Prompt -->
                            <p class="form-label fw-bold mb-3">
                                {% if lang() == 'de' %}{{ g.i18n.get('monthly_report.combined_prompt') }}{% else %}{{ g.i18n.get('monthly_report.combined_prompt') }}{% endif %}
                            </p>
                            
                            <!-- Observer Selection -->
                            <div class="filter-group mb-3">
                                <select id="observer-select" class="form-select">
                                    <option value="" id="observer-select-placeholder">-- {{ g.i18n.get('observers.select_prompt') }} --</option>
                                </select>
                            </div>

                            <!-- Month/Year Input -->
                            <div class="filter-group mb-3">
                                <input type="text" 
                                       id="month-year-input" 
                                       class="form-control"
                                       placeholder="{{ g.i18n.get('monthly_report.month_year_placeholder') }}"
                                       maxlength="5">
                                <div id="month-year-error" class="text-danger mt-1" style="display:none;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer py-2">
                        <button type="button" id="btn-cancel-filter" class="btn btn-secondary btn-sm px-3">
                            {{ g.i18n.get('common.cancel') }}
                        </button>
                        <button type="button" id="btn-apply-filter" class="btn btn-primary btn-sm px-3">
                            <span id="apply-spinner" class="spinner-border spinner-border-sm me-1" role="status" style="display:none;"></span>
                            {{ g.i18n.get('common.ok') }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Modal -->
        <div class="modal fade" id="results-modal" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true" data-bs-backdrop="true" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" style="max-width: 90%; width: fit-content;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="results-modal-title"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="report-content"></div>
                    </div>
                    <div class="modal-footer d-flex justify-content-end">
                        <button type="button" id="btn-report-ok" class="btn btn-primary btn-sm px-4">{{ g.i18n.get('common.ok') }}</button>
                        <button type="button" id="btn-report-print" class="btn btn-secondary btn-sm px-4">{{ g.i18n.get('monthly_report.print') }}</button>
                        <button type="button" id="btn-report-save" class="btn btn-secondary btn-sm px-4">{{ g.i18n.get('monthly_report.save') }}</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    {% include 'footer.html' %}

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}?v={{ static_version }}"></script>
    <script src="{{ url_for('static', filename='js/monthly_report.js') }}?v={{ static_version }}"></script>
</body>
</html>
