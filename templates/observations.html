<!DOCTYPE html>
<html lang="{{ lang() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HALO - {{ g.i18n.get('observations.display_title') }}</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- Bootstrap CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='fonts/bootstrap-icons/bootstrap-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="d-flex flex-column min-vh-100">
    {% include 'header.html' %}

    <script>
        // Mark observations menu as active
        document.addEventListener('DOMContentLoaded', () => {
            // Add small delay to ensure header is fully rendered
            setTimeout(() => {
                const menus = document.querySelectorAll('.menu-title');
                // Find Beobachtungen/Observations menu (3rd menu item, index 2)
                if (menus[2]) menus[2].classList.add('active');
            }, 50);
        });
    </script>

    <main class="container mt-4">
        <!-- Filter Selection Dialog Modal -->
        <div class="modal fade" id="filter-dialog" tabindex="-1" aria-labelledby="filterDialogLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="filterDialogLabel">{{ g.i18n.get('filter_dialog.title') }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="filter-form">
                            <div class="filter-group mb-3">
                                <label class="form-label">1. {{ g.i18n.get('filter_dialog.question_1') }}</label>
                                <select id="filter-criterion-1" class="form-select">
                                    <option value="none">{{ g.i18n.get('filter_dialog.no_criterion') }}</option>
                                    <option value="observer">{{ g.i18n.get('filter_dialog.observer_code') }}</option>
                                    <option value="region">{{ g.i18n.get('filter_dialog.region') }}</option>
                                </select>
                                <div id="filter-1-input" style="display:none;" class="mt-2">
                                    <select id="filter-1-select" class="form-select"></select>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">2. {{ g.i18n.get('filter_dialog.question_2') }}</label>
                                <select id="filter-criterion-2" class="form-select">
                                    <option value="none">{{ g.i18n.get('filter_dialog.no_criterion') }}</option>
                                    <option value="date">{{ g.i18n.get('common.day') }}</option>
                                    <option value="month">{{ g.i18n.get('common.month') }}</option>
                                    <option value="year">{{ g.i18n.get('common.year') }}</option>
                                    <option value="halo-type">{{ g.i18n.get('filter_dialog.halo_type') }}</option>
                                </select>
                                <div id="filter-2-input" style="display:none;" class="mt-2">
                                    <input type="text" id="filter-2-value" class="form-control" placeholder="">
                                    <select id="filter-2-select" class="form-select" style="display:none;"></select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer py-2">
                        <button type="button" id="btn-cancel-filter" class="btn btn-secondary btn-sm px-3">{{ g.i18n.get('common.cancel') }}</button>
                        <button type="button" id="btn-apply-filter" class="btn btn-primary btn-sm px-3">
                            <span id="apply-spinner" class="spinner-border spinner-border-sm me-1" role="status" style="display:none;"></span>
                            {{ g.i18n.get('common.ok') }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loading-spinner" class="text-center my-5" style="display:none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">{{ g.i18n.get('messages.loading_spinner') }}</span>
            </div>
            <p class="mt-2 text-muted">{{ g.i18n.get('messages.loading_file') }}</p>
        </div>

        <!-- Compact Display (Kurz mode) -->
        <div class="observations-compact-container" id="compact-view" style="display:none;">
            <div class="compact-header">
                <pre id="compact-header-text" style="font-family: 'Courier New', Consolas, monospace; font-size: 16px;">KKOJJ MMTTg ZZZZd DDNCc EEHFV fzzGG 8HHHH {{ g.i18n.get('fields.sectors').ljust(15) }} {{ g.i18n.get('fields.remarks') }}</pre>
            </div>
            <div class="compact-body">
                <pre id="compact-tbody" style="font-family: 'Courier New', Consolas, monospace; font-size: 16px; line-height: 1.4; margin: 0;"></pre>
            </div>
            <div class="compact-navigation mt-3 d-flex justify-content-center align-items-center gap-2">
                <button id="btn-first-page" class="btn btn-secondary btn-sm" title="{{ g.i18n.get('common.pagination_first') }}">
                    <i class="bi bi-chevron-bar-left"></i>
                </button>
                <button id="btn-prev-page" class="btn btn-secondary btn-sm" title="{{ g.i18n.get('common.pagination_prev') }}">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <span id="compact-page-info" class="mx-3 text-muted"></span>
                <button id="btn-next-page" class="btn btn-secondary btn-sm" title="{{ g.i18n.get('common.pagination_next') }}">
                    <i class="bi bi-chevron-right"></i>
                </button>
                <button id="btn-last-page" class="btn btn-secondary btn-sm" title="{{ g.i18n.get('common.pagination_last') }}">
                    <i class="bi bi-chevron-bar-right"></i>
                </button>
            </div>
        </div>

        <!-- Detailed Display (Lang mode) - one observation at a time -->
        <div class="observations-detail-container" id="detail-view" style="display:none;">
            <div id="detail-content"></div>
            <div class="detail-navigation">
                <button id="btn-prev-detail" class="btn btn-secondary btn-sm px-3">&lt; {{ g.i18n.get('common.previous') }}</button>
                <span id="detail-counter"></span>
                <button id="btn-next-detail" class="btn btn-secondary btn-sm px-3">{{ g.i18n.get('common.next') }} &gt;</button>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-3">
            <button id="btn-exit-observations" class="btn btn-secondary btn-sm px-3" style="display:none;">
                <span id="exit-text">{{ g.i18n.get('common.exit') }}</span>
            </button>
            <div class="ms-auto">
                <span id="record-count" class="text-muted me-3"></span>
                <span id="page-info" class="text-muted"></span>
            </div>
        </div>
    </main>

    {% include 'footer.html' %}

    <!-- Bootstrap JS Bundle -->
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/field-constraints.js') }}?v={{ static_version }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}?v={{ static_version }}"></script>
    <script src="{{ url_for('static', filename='js/observation-form.js') }}?v={{ static_version }}"></script>
    <script src="{{ url_for('static', filename='js/observations.js') }}"></script>
</body>
</html>
